#!/bin/sh --
set -eax
SCRIPT_DIR="$(cd -- "${0%/*}/" && pwd)"
. "$SCRIPT_DIR/../hc/tools/shell/recipe.sh"
recipe_init "host_llvm hc linux"

FILE_DEPENDENCIES="$(cd "$SCRIPT_DIR"; find ../bootloader -name "*.c" -print -o -name "*.h" -print)"

recipe_start
export NO_AARCH64=1 LLVM=host_llvm-out
export FLAGS="-I$PWD/linux-out"
"$SCRIPT_DIR/../hc/tools/build/efi.sh" "$SCRIPT_DIR/../bootloader/bootloader.c" bootloader
mkdir "$RECIPE_OUT"
mv "$SCRIPT_DIR/../hc-out/bootloader/x86_64" "$RECIPE_OUT/"
recipe_finish
